TODO:
 * scanner
   * optimize (more)
 * tag balancer
   * optimize
   * incorporate ideas from JTidy
